{"ast":null,"code":"import _classCallCheck from\"D:/programming/network.v1/cozy-space-client/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"D:/programming/network.v1/cozy-space-client/node_modules/@babel/runtime/helpers/esm/createClass\";import{setWsHeartbeat}from'ws-heartbeat/client';var serverAddress=process.env.REACT_APP_URL||'127.0.0.1:3001';export var Posts=/*#__PURE__*/function(){function Posts(){var _this=this;_classCallCheck(this,Posts);this.ws=void 0;this.handleNewPost=void 0;this.ws=new WebSocket(\"wss://\".concat(serverAddress));setWsHeartbeat(this.ws,'{\"kind\":\"ping\"}',{pingTimeout:60000,pingInterval:25000});this.ws.onmessage=function(event){var data=event.data;var parsed=JSON.parse(data);if(parsed.name&&parsed.text){var _this$handleNewPost;(_this$handleNewPost=_this.handleNewPost)===null||_this$handleNewPost===void 0?void 0:_this$handleNewPost.call(_this,parsed);}};}_createClass(Posts,[{key:\"onNewPost\",value:function onNewPost(callback){this.handleNewPost=callback;}},{key:\"getPosts\",value:function getPosts(){return fetch(\"https://\".concat(serverAddress,\"/get_posts\"));}},{key:\"sendPost\",value:function sendPost(post){return fetch(\"https://\".concat(serverAddress,\"/send_post?name=\").concat(post.name,\"&text=\").concat(post.text));}}]);return Posts;}();","map":{"version":3,"sources":["D:/programming/network.v1/cozy-space-client/src/Data.ts"],"names":["setWsHeartbeat","serverAddress","process","env","REACT_APP_URL","Posts","ws","handleNewPost","WebSocket","pingTimeout","pingInterval","onmessage","event","data","parsed","JSON","parse","name","text","callback","fetch","post"],"mappings":"0PACA,OAASA,cAAT,KAA+B,qBAA/B,CAEA,GAAMC,CAAAA,aAAa,CAAGC,OAAO,CAACC,GAAR,CAAYC,aAAZ,EAA6B,gBAAnD,CAEA,UAAaC,CAAAA,KAAb,yBAIE,gBAAc,iDAHNC,EAGM,aAFNC,aAEM,QACZ,KAAKD,EAAL,CAAU,GAAIE,CAAAA,SAAJ,iBAAuBP,aAAvB,EAAV,CACAD,cAAc,CAAC,KAAKM,EAAN,CAAU,iBAAV,CAA6B,CACzCG,WAAW,CAAE,KAD4B,CAEzCC,YAAY,CAAE,KAF2B,CAA7B,CAAd,CAIA,KAAKJ,EAAL,CAAQK,SAAR,CAAoB,SAAAC,KAAK,CAAI,CAC3B,GAAQC,CAAAA,IAAR,CAAiBD,KAAjB,CAAQC,IAAR,CACA,GAAMC,CAAAA,MAAM,CAAGC,IAAI,CAACC,KAAL,CAAWH,IAAX,CAAf,CACA,GAAIC,MAAM,CAACG,IAAP,EAAeH,MAAM,CAACI,IAA1B,CAAgC,yBAC9B,qBAAA,KAAI,CAACX,aAAL,uEAAA,KAAI,CAAiBO,MAAjB,CAAJ,CACD,CACF,CAND,CAOD,CAjBH,2CAmBE,mBAAUK,QAAV,CAA8C,CAC5C,KAAKZ,aAAL,CAAqBY,QAArB,CACD,CArBH,wBAuBE,mBAAW,CACT,MAAOC,CAAAA,KAAK,mBAAYnB,aAAZ,eAAZ,CACD,CAzBH,wBA0BE,kBAASoB,IAAT,CAAqB,CACnB,MAAOD,CAAAA,KAAK,mBAAYnB,aAAZ,4BAA4CoB,IAAI,CAACJ,IAAjD,kBAA8DI,IAAI,CAACH,IAAnE,EAAZ,CACD,CA5BH","sourcesContent":["import { FullPost, Post } from './types'\r\nimport { setWsHeartbeat } from 'ws-heartbeat/client'\r\n\r\nconst serverAddress = process.env.REACT_APP_URL || '127.0.0.1:3001'\r\n\r\nexport class Posts {\r\n  private ws: WebSocket\r\n  private handleNewPost?: (post: FullPost) => void \r\n  \r\n  constructor() {\r\n    this.ws = new WebSocket(`wss://${serverAddress}`)\r\n    setWsHeartbeat(this.ws, '{\"kind\":\"ping\"}', {\r\n      pingTimeout: 60000,\r\n      pingInterval: 25000, \r\n    })\r\n    this.ws.onmessage = event => { \r\n      const { data } = event\r\n      const parsed = JSON.parse(data)\r\n      if (parsed.name && parsed.text) {\r\n        this.handleNewPost?.(parsed)\r\n      } \r\n    }\r\n  }\r\n\r\n  onNewPost(callback: (post: FullPost) => void) {\r\n    this.handleNewPost = callback\r\n  }\r\n\r\n  getPosts() {\r\n    return fetch(`https://${serverAddress}/get_posts`)\r\n  }\r\n  sendPost(post: Post) {\r\n    return fetch(`https://${serverAddress}/send_post?name=${post.name}&text=${post.text}`)\r\n  }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}